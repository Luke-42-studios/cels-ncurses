---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - include/cels-ncurses/tui_types.h
autonomous: true

must_haves:
  truths:
    - "TUI_Rect stores float x/y/w/h coordinates that match Clay_BoundingBox layout"
    - "TUI_CellRect stores integer cell coordinates for ncurses drawing"
    - "tui_rect_to_cells uses floorf for position and ceilf for dimensions"
    - "tui_cell_rect_intersect computes correct intersection including degenerate (zero-area) results"
    - "Negative coordinates are allowed in both TUI_Rect and TUI_CellRect"
  artifacts:
    - path: "include/cels-ncurses/tui_types.h"
      provides: "TUI_Rect, TUI_CellRect, tui_rect_to_cells, tui_cell_rect_intersect, tui_cell_rect_contains"
      contains: "typedef struct TUI_Rect"
  key_links:
    - from: "include/cels-ncurses/tui_types.h"
      to: "math.h"
      via: "floorf/ceilf in tui_rect_to_cells"
      pattern: "floorf|ceilf"
---

<objective>
Create the coordinate type vocabulary for the graphics API: TUI_Rect (float coordinates for Clay compatibility) and TUI_CellRect (integer cell coordinates for ncurses), plus conversion and geometry utility functions.

Purpose: All drawing operations, clipping, and layout mapping in subsequent phases depend on these foundational coordinate types. TUI_Rect receives float values from Clay's layout engine; TUI_CellRect is what ncurses actually uses.

Output: `include/cels-ncurses/tui_types.h` -- header-only (all functions are static inline).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/codebase/CONVENTIONS.md

# Existing headers for style reference
@include/cels-ncurses/tui_window.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tui_types.h with TUI_Rect, TUI_CellRect, and geometry utilities</name>
  <files>include/cels-ncurses/tui_types.h</files>
  <action>
Create `include/cels-ncurses/tui_types.h` with the following contents:

**Header documentation block** following the project convention (see tui_window.h for style):
- File purpose: Coordinate types and geometry utilities for the TUI graphics API
- Usage example showing TUI_Rect creation and conversion to TUI_CellRect

**Include guard:** `CELS_NCURSES_TUI_TYPES_H`

**Includes:** `<math.h>` (for floorf, ceilf)

**TUI_Rect struct** (float coordinates, Clay-compatible):
```c
typedef struct TUI_Rect {
    float x, y, w, h;
} TUI_Rect;
```
- x/y = position (floorf snaps to top-left cell)
- w/h = dimensions (ceilf ensures content not clipped)
- Negative x/y are valid (off-screen, handled by clipping)

**TUI_CellRect struct** (integer cell coordinates, ncurses-native):
```c
typedef struct TUI_CellRect {
    int x, y, w, h;
} TUI_CellRect;
```

**static inline TUI_CellRect tui_rect_to_cells(TUI_Rect r):**
- x = (int)floorf(r.x), y = (int)floorf(r.y)
- w = (int)ceilf(r.w), h = (int)ceilf(r.h)
- Use the exact implementation from RESEARCH.md code examples

**static inline TUI_CellRect tui_cell_rect_intersect(TUI_CellRect a, TUI_CellRect b):**
- Compute intersection. If no overlap, return rect with w=0, h=0.
- Use the exact implementation from RESEARCH.md code examples (max of lefts/tops, min of rights/bottoms, clamp negative dimensions to 0)

**static inline int tui_cell_rect_contains(TUI_CellRect r, int px, int py):**
- Returns 1 if point (px, py) is inside rect, 0 otherwise
- Check: px >= r.x && px < r.x + r.w && py >= r.y && py < r.y + r.h

Use `/* ... */` comments only (no `//`), 4-space indent, section separators with `=` dividers matching project conventions. End with `#endif /* CELS_NCURSES_TUI_TYPES_H */`.
  </action>
  <verify>
Compile check: Run the consumer project's CMake build to verify the header parses without errors. If no consumer build is available, create a minimal test:
```bash
echo '#include "cels-ncurses/tui_types.h"
int main(void) {
    TUI_Rect r = {1.5f, 2.7f, 10.3f, 5.1f};
    TUI_CellRect c = tui_rect_to_cells(r);
    TUI_CellRect a = {0, 0, 20, 10};
    TUI_CellRect b = {5, 3, 20, 10};
    TUI_CellRect i = tui_cell_rect_intersect(a, b);
    int inside = tui_cell_rect_contains(a, 10, 5);
    (void)c; (void)i; (void)inside;
    return 0;
}' > /tmp/test_tui_types.c
gcc -std=c99 -Wall -Wextra -pedantic -I include -lm -o /tmp/test_tui_types /tmp/test_tui_types.c && echo "PASS" || echo "FAIL"
```
Verify: floorf(1.5)=1, floorf(2.7)=2, ceilf(10.3)=11, ceilf(5.1)=6 -- so c should be {1, 2, 11, 6}.
Verify: intersect of {0,0,20,10} and {5,3,20,10} should be {5, 3, 15, 7}.
Verify: contains({0,0,20,10}, 10, 5) should return 1.
  </verify>
  <done>
- tui_types.h exists at include/cels-ncurses/tui_types.h
- Contains TUI_Rect (float x/y/w/h) and TUI_CellRect (int x/y/w/h) struct definitions
- tui_rect_to_cells uses floorf for position and ceilf for dimensions
- tui_cell_rect_intersect returns zero-area rect on no overlap
- tui_cell_rect_contains does correct point-in-rect test
- Compiles cleanly with -std=c99 -Wall -Wextra -pedantic
  </done>
</task>

</tasks>

<verification>
- `include/cels-ncurses/tui_types.h` exists and compiles with C99 -Wall -Wextra -pedantic
- TUI_Rect stores float x, y, w, h
- TUI_CellRect stores int x, y, w, h
- tui_rect_to_cells({1.5, 2.7, 10.3, 5.1}) produces {1, 2, 11, 6}
- tui_cell_rect_intersect handles non-overlapping rects (returns w=0, h=0)
- Negative coordinates compile and behave correctly (no unsigned casts)
</verification>

<success_criteria>
Header-only tui_types.h provides the complete coordinate type vocabulary. Any subsequent code can `#include <cels-ncurses/tui_types.h>` and use TUI_Rect, TUI_CellRect, tui_rect_to_cells, tui_cell_rect_intersect, and tui_cell_rect_contains without additional dependencies beyond math.h.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
