---
phase: 02-drawing-primitives
plan: 05
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/graphics/tui_draw.c
autonomous: true

must_haves:
  truths:
    - "Developer can draw a horizontal line at a given position with configurable length and border style"
    - "Developer can draw a vertical line at a given position with configurable length and border style"
    - "Lines are clipped against TUI_DrawContext.clip before issuing ncurses calls"
    - "Lines use the correct box-drawing characters for single, double, and rounded border styles"
  artifacts:
    - path: "src/graphics/tui_draw.c"
      provides: "tui_draw_hline, tui_draw_vline implementations"
      contains: "tui_draw_hline"
  key_links:
    - from: "tui_draw_hline"
      to: "tui_border_chars_get"
      via: "gets correct line character for border style"
      pattern: "tui_border_chars_get"
    - from: "tui_draw_hline"
      to: "mvwhline_set"
      via: "ncurses built-in horizontal line drawing"
      pattern: "mvwhline_set"
    - from: "tui_draw_vline"
      to: "mvwvline_set"
      via: "ncurses built-in vertical line drawing"
      pattern: "mvwvline_set"
---

<objective>
Implement horizontal and vertical line drawing with box-drawing characters and clipping support.

Purpose: Lines are the building blocks for borders and visual separators. They use ncurses built-in mvwhline_set/mvwvline_set for efficiency (these handle edge cases and respect attributes correctly). Line clipping is done by computing the visible segment before calling the ncurses function.

Output: tui_draw_hline and tui_draw_vline added to the existing tui_draw.c.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-drawing-primitives/02-RESEARCH.md
@.planning/codebase/CONVENTIONS.md
@include/cels-ncurses/tui_draw.h
@src/graphics/tui_draw.c
@.planning/phases/02-drawing-primitives/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement tui_draw_hline and tui_draw_vline in tui_draw.c</name>
  <files>src/graphics/tui_draw.c</files>
  <action>
  Add two new functions to tui_draw.c, in a new section after the existing rectangle drawing section. Use a section separator:

  ```c
  /* ============================================================================
   * Line Drawing (DRAW-11)
   * ============================================================================ */
  ```

  **tui_draw_hline implementation:**
  - Parameters: `TUI_DrawContext* ctx, int x, int y, int length, TUI_BorderStyle border_style, TUI_Style style`
  - Early return if length <= 0
  - Clip the line vertically: if `y < ctx->clip.y || y >= ctx->clip.y + ctx->clip.h`, return (row not visible)
  - Clip the line horizontally:
    - `left = (x > ctx->clip.x) ? x : ctx->clip.x`
    - `right_end = x + length` (one past the last column)
    - `clip_right = ctx->clip.x + ctx->clip.w`
    - `right = (right_end < clip_right) ? right_end : clip_right`
    - `visible_len = right - left`
    - If `visible_len <= 0`, return (fully clipped)
  - Get border characters: `TUI_BorderChars chars = tui_border_chars_get(border_style)`
  - Apply style: `tui_style_apply(ctx->win, style)`
  - Draw: `mvwhline_set(ctx->win, y, left, chars.hline, visible_len)`
  - Do NOT use a per-cell loop for horizontal lines -- mvwhline_set is the correct ncurses function (see research "Don't Hand-Roll" section)

  **tui_draw_vline implementation:**
  - Parameters: `TUI_DrawContext* ctx, int x, int y, int length, TUI_BorderStyle border_style, TUI_Style style`
  - Early return if length <= 0
  - Clip the line horizontally: if `x < ctx->clip.x || x >= ctx->clip.x + ctx->clip.w`, return (column not visible)
  - Clip the line vertically:
    - `top = (y > ctx->clip.y) ? y : ctx->clip.y`
    - `bottom_end = y + length`
    - `clip_bottom = ctx->clip.y + ctx->clip.h`
    - `bottom = (bottom_end < clip_bottom) ? bottom_end : clip_bottom`
    - `visible_len = bottom - top`
    - If `visible_len <= 0`, return (fully clipped)
  - Get border characters: `TUI_BorderChars chars = tui_border_chars_get(border_style)`
  - Apply style: `tui_style_apply(ctx->win, style)`
  - Draw: `mvwvline_set(ctx->win, top, x, chars.vline, visible_len)`
  - Do NOT use a per-cell loop for vertical lines -- mvwvline_set is the correct ncurses function

  Both functions must NOT call wrefresh, wnoutrefresh, or doupdate.
  </action>
  <verify>
  1. Build the project: verify no compilation errors or warnings.
  2. `grep -n 'tui_draw_hline\|tui_draw_vline' src/graphics/tui_draw.c` shows both function implementations.
  3. `grep -n 'mvwhline_set\|mvwvline_set' src/graphics/tui_draw.c` shows ncurses line functions are used.
  4. `grep -n 'wrefresh\|wnoutrefresh\|doupdate' src/graphics/tui_draw.c` returns no matches.
  5. `grep -n 'tui_border_chars_get' src/graphics/tui_draw.c` shows both line functions use the border char lookup.
  </verify>
  <done>
  tui_draw_hline draws a clipped horizontal line using mvwhline_set with the correct box-drawing character for the given border style. tui_draw_vline draws a clipped vertical line using mvwvline_set. Both clip against ctx->clip before issuing ncurses calls. No refresh calls.
  </done>
</task>

</tasks>

<verification>
- tui_draw_hline and tui_draw_vline exist in src/graphics/tui_draw.c
- Both use tui_border_chars_get to select the correct box-drawing character
- Both use mvwhline_set/mvwvline_set (not per-cell loops) for drawing
- Both clip against ctx->clip before drawing (row/column visibility check + segment clipping)
- Both handle length <= 0 with early return
- No wrefresh/wnoutrefresh/doupdate calls
- Build succeeds with no errors
</verification>

<success_criteria>
Developer can draw horizontal and vertical lines at arbitrary positions with single, double, or rounded border style characters. Lines are correctly clipped to the draw context's clip region.
</success_criteria>

<output>
After completion, create `.planning/phases/02-drawing-primitives/02-05-SUMMARY.md`
</output>
